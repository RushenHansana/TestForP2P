{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\disan\\\\OneDrive\\\\Documents\\\\NCINGA\\\\Test\\\\users\\\\src\\\\App.js\",\n  _s = $RefreshSig$();\n// App.js\nimport React, { useEffect, useRef, useState } from \"react\";\nimport io from \"socket.io-client\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst socket = io.connect(\"http://localhost:5000\"); // Connect to signaling server\n\nfunction App() {\n  _s();\n  const [roomID, setRoomID] = useState(\"\");\n  const [stream, setStream] = useState(null);\n  const myVideo = useRef();\n  const remoteVideo = useRef();\n  const peerConnection = useRef(null);\n  const [usersJoined, setUsersJoined] = useState([]);\n  useEffect(() => {\n    // Extract room ID from URL only once when the component mounts\n    const url = window.location.href;\n    const splitURL = url.split(\"/\");\n    const roomIDFromURL = splitURL[splitURL.length - 1];\n    setRoomID(roomIDFromURL);\n    console.log(\"Room ID:\", roomIDFromURL);\n\n    // Get user media\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      setStream(stream);\n      myVideo.current.srcObject = stream;\n\n      // Establish connection with signaling server\n      socket.emit(\"joinRoom\", roomIDFromURL);\n    }).catch(error => {\n      console.error(\"Error accessing media devices:\", error);\n    });\n    socket.on(\"receiveIceCandidate\", data => {\n      // Add the received ICE candidate to the peer connection\n      if (peerConnection.current) {\n        peerConnection.current.addIceCandidate(data.candidate);\n      }\n    });\n\n    // Handle new user joined the room\n    socket.on(\"userJoined\", user => {\n      // Check if the user has already joined the room\n      if (!usersJoined.includes(user)) {\n        setUsersJoined(prevUsersJoined => [...prevUsersJoined, user]);\n\n        // Create a new peer connection for the user who joins the room\n        if (user !== socket.id) {\n          const peer = new RTCPeerConnection({\n            iceServers: [{\n              urls: \"stun:stun.l.google.com:19302\"\n            }, {\n              urls: \"stun:stun1.l.google.com:19302\"\n            }]\n          });\n\n          // Add tracks to the peer connection\n          if (stream) {\n            stream.getTracks().forEach(track => {\n              peer.addTrack(track, stream);\n            });\n          }\n\n          // Set up event listeners for the peer connection\n          peer.onicecandidate = event => {\n            if (event.candidate) {\n              // Send ICE candidate to the signaling server\n              socket.emit(\"sendIceCandidate\", {\n                candidate: event.candidate,\n                to: user\n              });\n            }\n          };\n          peer.ontrack = event => {\n            // Add the remote stream to the video element\n            if (event.streams && event.streams[0]) {\n              remoteVideo.current.srcObject = event.streams[0];\n            }\n          };\n\n          // Create offer and set local description\n          peer.createOffer().then(offer => peer.setLocalDescription(offer)).then(() => {\n            // Emit the offer to the signaling server\n            socket.emit(\"callUser\", {\n              userToCall: user,\n              signalData: peer.localDescription,\n              from: socket.id\n            });\n          }).catch(error => {\n            console.error(\"Error creating or setting local description:\", error);\n          });\n\n          // Store the peer connection in a reference\n          peerConnection.current = peer;\n        }\n      }\n    });\n    return () => {\n      // Clean up event listeners\n      socket.off(\"receiveIceCandidate\");\n      socket.off(\"callAccepted\");\n    };\n  }, [stream, usersJoined]); // Dependencies: stream and usersJoined\n\n  const handleToggleMic = () => {\n    if (stream) {\n      const audioTracks = stream.getAudioTracks();\n      audioTracks.forEach(track => {\n        track.enabled = !track.enabled;\n      });\n    }\n  };\n  const handleToggleCamera = () => {\n    if (stream) {\n      const videoTracks = stream.getVideoTracks();\n      videoTracks.forEach(track => {\n        track.enabled = !track.enabled;\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"video\", {\n      ref: myVideo,\n      autoPlay: true,\n      muted: true,\n      style: {\n        width: \"300px\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n      ref: remoteVideo,\n      autoPlay: true,\n      style: {\n        width: \"300px\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleToggleMic,\n      children: \"Toggle Mic\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleToggleCamera,\n      children: \"Toggle Camera\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 134,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"oetSvydeI6uP81tfMXVfnydlqCM=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useEffect","useRef","useState","io","jsxDEV","_jsxDEV","socket","connect","App","_s","roomID","setRoomID","stream","setStream","myVideo","remoteVideo","peerConnection","usersJoined","setUsersJoined","url","window","location","href","splitURL","split","roomIDFromURL","length","console","log","navigator","mediaDevices","getUserMedia","video","audio","then","current","srcObject","emit","catch","error","on","data","addIceCandidate","candidate","user","includes","prevUsersJoined","id","peer","RTCPeerConnection","iceServers","urls","getTracks","forEach","track","addTrack","onicecandidate","event","to","ontrack","streams","createOffer","offer","setLocalDescription","userToCall","signalData","localDescription","from","off","handleToggleMic","audioTracks","getAudioTracks","enabled","handleToggleCamera","videoTracks","getVideoTracks","children","ref","autoPlay","muted","style","width","fileName","_jsxFileName","lineNumber","columnNumber","onClick","_c","$RefreshReg$"],"sources":["C:/Users/disan/OneDrive/Documents/NCINGA/Test/users/src/App.js"],"sourcesContent":["// App.js\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport io from \"socket.io-client\";\r\n\r\nconst socket = io.connect(\"http://localhost:5000\"); // Connect to signaling server\r\n\r\nfunction App() {\r\n  const [roomID, setRoomID] = useState(\"\");\r\n  const [stream, setStream] = useState(null);\r\n  const myVideo = useRef();\r\n  const remoteVideo = useRef();\r\n  const peerConnection = useRef(null);\r\n  const [usersJoined, setUsersJoined] = useState([]);\r\n\r\n  useEffect(() => {\r\n    // Extract room ID from URL only once when the component mounts\r\n    const url = window.location.href;\r\n    const splitURL = url.split(\"/\");\r\n    const roomIDFromURL = splitURL[splitURL.length - 1];\r\n    setRoomID(roomIDFromURL);\r\n    console.log(\"Room ID:\", roomIDFromURL);\r\n\r\n    // Get user media\r\n    navigator.mediaDevices\r\n      .getUserMedia({\r\n        video: true,\r\n        audio: true,\r\n      })\r\n      .then((stream) => {\r\n        setStream(stream);\r\n        myVideo.current.srcObject = stream;\r\n\r\n        // Establish connection with signaling server\r\n        socket.emit(\"joinRoom\", roomIDFromURL);\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error accessing media devices:\", error);\r\n      });\r\n\r\n    socket.on(\"receiveIceCandidate\", (data) => {\r\n      // Add the received ICE candidate to the peer connection\r\n      if (peerConnection.current) {\r\n        peerConnection.current.addIceCandidate(data.candidate);\r\n      }\r\n    });\r\n  \r\n    // Handle new user joined the room\r\n    socket.on(\"userJoined\", (user) => {\r\n      // Check if the user has already joined the room\r\n      if (!usersJoined.includes(user)) {\r\n        setUsersJoined((prevUsersJoined) => [...prevUsersJoined, user]);\r\n\r\n        // Create a new peer connection for the user who joins the room\r\n        if (user !== socket.id) {\r\n          const peer = new RTCPeerConnection({\r\n            iceServers: [\r\n              { urls: \"stun:stun.l.google.com:19302\" },\r\n              { urls: \"stun:stun1.l.google.com:19302\" },\r\n            ],\r\n          });\r\n  \r\n          // Add tracks to the peer connection\r\n          if (stream) {\r\n            stream.getTracks().forEach((track) => {\r\n              peer.addTrack(track, stream);\r\n            });\r\n          }\r\n  \r\n          // Set up event listeners for the peer connection\r\n          peer.onicecandidate = (event) => {\r\n            if (event.candidate) {\r\n              // Send ICE candidate to the signaling server\r\n              socket.emit(\"sendIceCandidate\", {\r\n                candidate: event.candidate,\r\n                to: user,\r\n              });\r\n            }\r\n          };\r\n  \r\n          peer.ontrack = (event) => {\r\n            // Add the remote stream to the video element\r\n            if (event.streams && event.streams[0]) {\r\n              remoteVideo.current.srcObject = event.streams[0];\r\n            }\r\n          };\r\n  \r\n          // Create offer and set local description\r\n          peer.createOffer()\r\n            .then((offer) => peer.setLocalDescription(offer))\r\n            .then(() => {\r\n              // Emit the offer to the signaling server\r\n              socket.emit(\"callUser\", {\r\n                userToCall: user,\r\n                signalData: peer.localDescription,\r\n                from: socket.id,\r\n              });\r\n            })\r\n            .catch((error) => {\r\n              console.error(\"Error creating or setting local description:\", error);\r\n            });\r\n  \r\n          // Store the peer connection in a reference\r\n          peerConnection.current = peer;\r\n        }\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      // Clean up event listeners\r\n      socket.off(\"receiveIceCandidate\");\r\n      socket.off(\"callAccepted\");\r\n    };\r\n  }, [stream, usersJoined]); // Dependencies: stream and usersJoined\r\n\r\n  const handleToggleMic = () => {\r\n    if (stream) {\r\n      const audioTracks = stream.getAudioTracks();\r\n      audioTracks.forEach((track) => {\r\n        track.enabled = !track.enabled;\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleToggleCamera = () => {\r\n    if (stream) {\r\n      const videoTracks = stream.getVideoTracks();\r\n      videoTracks.forEach((track) => {\r\n        track.enabled = !track.enabled;\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <video ref={myVideo} autoPlay muted style={{ width: \"300px\" }} />\r\n      <video ref={remoteVideo} autoPlay style={{ width: \"300px\" }} />\r\n      <button onClick={handleToggleMic}>Toggle Mic</button>\r\n      <button onClick={handleToggleCamera}>Toggle Camera</button>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"mappings":";;AAAA;AACA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,OAAO;AAC1D,OAAOC,EAAE,MAAM,kBAAkB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAElC,MAAMC,MAAM,GAAGH,EAAE,CAACI,OAAO,CAAC,uBAAuB,CAAC,CAAC,CAAC;;AAEpD,SAASC,GAAGA,CAAA,EAAG;EAAAC,EAAA;EACb,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAGT,QAAQ,CAAC,EAAE,CAAC;EACxC,MAAM,CAACU,MAAM,EAAEC,SAAS,CAAC,GAAGX,QAAQ,CAAC,IAAI,CAAC;EAC1C,MAAMY,OAAO,GAAGb,MAAM,CAAC,CAAC;EACxB,MAAMc,WAAW,GAAGd,MAAM,CAAC,CAAC;EAC5B,MAAMe,cAAc,GAAGf,MAAM,CAAC,IAAI,CAAC;EACnC,MAAM,CAACgB,WAAW,EAAEC,cAAc,CAAC,GAAGhB,QAAQ,CAAC,EAAE,CAAC;EAElDF,SAAS,CAAC,MAAM;IACd;IACA,MAAMmB,GAAG,GAAGC,MAAM,CAACC,QAAQ,CAACC,IAAI;IAChC,MAAMC,QAAQ,GAAGJ,GAAG,CAACK,KAAK,CAAC,GAAG,CAAC;IAC/B,MAAMC,aAAa,GAAGF,QAAQ,CAACA,QAAQ,CAACG,MAAM,GAAG,CAAC,CAAC;IACnDf,SAAS,CAACc,aAAa,CAAC;IACxBE,OAAO,CAACC,GAAG,CAAC,UAAU,EAAEH,aAAa,CAAC;;IAEtC;IACAI,SAAS,CAACC,YAAY,CACnBC,YAAY,CAAC;MACZC,KAAK,EAAE,IAAI;MACXC,KAAK,EAAE;IACT,CAAC,CAAC,CACDC,IAAI,CAAEtB,MAAM,IAAK;MAChBC,SAAS,CAACD,MAAM,CAAC;MACjBE,OAAO,CAACqB,OAAO,CAACC,SAAS,GAAGxB,MAAM;;MAElC;MACAN,MAAM,CAAC+B,IAAI,CAAC,UAAU,EAAEZ,aAAa,CAAC;IACxC,CAAC,CAAC,CACDa,KAAK,CAAEC,KAAK,IAAK;MAChBZ,OAAO,CAACY,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;IACxD,CAAC,CAAC;IAEJjC,MAAM,CAACkC,EAAE,CAAC,qBAAqB,EAAGC,IAAI,IAAK;MACzC;MACA,IAAIzB,cAAc,CAACmB,OAAO,EAAE;QAC1BnB,cAAc,CAACmB,OAAO,CAACO,eAAe,CAACD,IAAI,CAACE,SAAS,CAAC;MACxD;IACF,CAAC,CAAC;;IAEF;IACArC,MAAM,CAACkC,EAAE,CAAC,YAAY,EAAGI,IAAI,IAAK;MAChC;MACA,IAAI,CAAC3B,WAAW,CAAC4B,QAAQ,CAACD,IAAI,CAAC,EAAE;QAC/B1B,cAAc,CAAE4B,eAAe,IAAK,CAAC,GAAGA,eAAe,EAAEF,IAAI,CAAC,CAAC;;QAE/D;QACA,IAAIA,IAAI,KAAKtC,MAAM,CAACyC,EAAE,EAAE;UACtB,MAAMC,IAAI,GAAG,IAAIC,iBAAiB,CAAC;YACjCC,UAAU,EAAE,CACV;cAAEC,IAAI,EAAE;YAA+B,CAAC,EACxC;cAAEA,IAAI,EAAE;YAAgC,CAAC;UAE7C,CAAC,CAAC;;UAEF;UACA,IAAIvC,MAAM,EAAE;YACVA,MAAM,CAACwC,SAAS,CAAC,CAAC,CAACC,OAAO,CAAEC,KAAK,IAAK;cACpCN,IAAI,CAACO,QAAQ,CAACD,KAAK,EAAE1C,MAAM,CAAC;YAC9B,CAAC,CAAC;UACJ;;UAEA;UACAoC,IAAI,CAACQ,cAAc,GAAIC,KAAK,IAAK;YAC/B,IAAIA,KAAK,CAACd,SAAS,EAAE;cACnB;cACArC,MAAM,CAAC+B,IAAI,CAAC,kBAAkB,EAAE;gBAC9BM,SAAS,EAAEc,KAAK,CAACd,SAAS;gBAC1Be,EAAE,EAAEd;cACN,CAAC,CAAC;YACJ;UACF,CAAC;UAEDI,IAAI,CAACW,OAAO,GAAIF,KAAK,IAAK;YACxB;YACA,IAAIA,KAAK,CAACG,OAAO,IAAIH,KAAK,CAACG,OAAO,CAAC,CAAC,CAAC,EAAE;cACrC7C,WAAW,CAACoB,OAAO,CAACC,SAAS,GAAGqB,KAAK,CAACG,OAAO,CAAC,CAAC,CAAC;YAClD;UACF,CAAC;;UAED;UACAZ,IAAI,CAACa,WAAW,CAAC,CAAC,CACf3B,IAAI,CAAE4B,KAAK,IAAKd,IAAI,CAACe,mBAAmB,CAACD,KAAK,CAAC,CAAC,CAChD5B,IAAI,CAAC,MAAM;YACV;YACA5B,MAAM,CAAC+B,IAAI,CAAC,UAAU,EAAE;cACtB2B,UAAU,EAAEpB,IAAI;cAChBqB,UAAU,EAAEjB,IAAI,CAACkB,gBAAgB;cACjCC,IAAI,EAAE7D,MAAM,CAACyC;YACf,CAAC,CAAC;UACJ,CAAC,CAAC,CACDT,KAAK,CAAEC,KAAK,IAAK;YAChBZ,OAAO,CAACY,KAAK,CAAC,8CAA8C,EAAEA,KAAK,CAAC;UACtE,CAAC,CAAC;;UAEJ;UACAvB,cAAc,CAACmB,OAAO,GAAGa,IAAI;QAC/B;MACF;IACF,CAAC,CAAC;IAEF,OAAO,MAAM;MACX;MACA1C,MAAM,CAAC8D,GAAG,CAAC,qBAAqB,CAAC;MACjC9D,MAAM,CAAC8D,GAAG,CAAC,cAAc,CAAC;IAC5B,CAAC;EACH,CAAC,EAAE,CAACxD,MAAM,EAAEK,WAAW,CAAC,CAAC,CAAC,CAAC;;EAE3B,MAAMoD,eAAe,GAAGA,CAAA,KAAM;IAC5B,IAAIzD,MAAM,EAAE;MACV,MAAM0D,WAAW,GAAG1D,MAAM,CAAC2D,cAAc,CAAC,CAAC;MAC3CD,WAAW,CAACjB,OAAO,CAAEC,KAAK,IAAK;QAC7BA,KAAK,CAACkB,OAAO,GAAG,CAAClB,KAAK,CAACkB,OAAO;MAChC,CAAC,CAAC;IACJ;EACF,CAAC;EAED,MAAMC,kBAAkB,GAAGA,CAAA,KAAM;IAC/B,IAAI7D,MAAM,EAAE;MACV,MAAM8D,WAAW,GAAG9D,MAAM,CAAC+D,cAAc,CAAC,CAAC;MAC3CD,WAAW,CAACrB,OAAO,CAAEC,KAAK,IAAK;QAC7BA,KAAK,CAACkB,OAAO,GAAG,CAAClB,KAAK,CAACkB,OAAO;MAChC,CAAC,CAAC;IACJ;EACF,CAAC;EAED,oBACEnE,OAAA;IAAAuE,QAAA,gBACEvE,OAAA;MAAOwE,GAAG,EAAE/D,OAAQ;MAACgE,QAAQ;MAACC,KAAK;MAACC,KAAK,EAAE;QAAEC,KAAK,EAAE;MAAQ;IAAE;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eACjEhF,OAAA;MAAOwE,GAAG,EAAE9D,WAAY;MAAC+D,QAAQ;MAACE,KAAK,EAAE;QAAEC,KAAK,EAAE;MAAQ;IAAE;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eAC/DhF,OAAA;MAAQiF,OAAO,EAAEjB,eAAgB;MAAAO,QAAA,EAAC;IAAU;MAAAM,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAQ,CAAC,eACrDhF,OAAA;MAAQiF,OAAO,EAAEb,kBAAmB;MAAAG,QAAA,EAAC;IAAa;MAAAM,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAQ,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACxD,CAAC;AAEV;AAAC5E,EAAA,CAtIQD,GAAG;AAAA+E,EAAA,GAAH/E,GAAG;AAwIZ,eAAeA,GAAG;AAAC,IAAA+E,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}